"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const S=require("@nhost/nhost-js"),a=require("vue"),r=require("@xstate/vue"),C=require("@vueuse/core"),L=require("jwt-decode"),T=Symbol("default-nhost-client");let K;function E(){let t;const e=K;if(!a.getCurrentInstance())t=()=>e;else{const i=a.inject(T,null);t=()=>i}function s(){const i=t();if(!i)throw new Error("No Nhost client found. Use provideNhostClient() if you are outside of a component setup.");return i}return{resolveNhostClient:s,get nhost(){return s()}}}class N extends S.NhostClient{constructor(e){var s;super({...e,start:!0}),this.autoSignIn=(s=e.autoSignIn)!=null?s:!0}install(e){const s=this.autoSignIn;if(e.provide(T,this),s){const i=e.config.globalProperties.$router;if(!i)return;if(i.options.history.base){a.warn("[Nhost]: Vue-router is configured with a history Hash Mode. Refresh tokens will not be removed from the hash.");return}i.afterEach(()=>{S.removeParameterFromWindow("refreshToken"),S.removeParameterFromWindow("type")})}}}const p=()=>{const{nhost:t}=E();return a.computed(()=>{const e=t.auth.client.interpreter;if(!e)throw Error("No interpreter");return e})},P=()=>{const t=p();return r.useSelector(t.value,e=>e.context.accessToken.value)},k=()=>{const t=p();return r.useSelector(t.value,e=>e.matches({authentication:"signedIn"}))},M=()=>{const t=p();return C.toRefs(r.useSelector(t.value,e=>({isAuthenticated:e.matches({authentication:"signedIn"}),isLoading:e.hasTag("loading"),error:e.context.errors.authentication||null,isError:e.matches({authentication:{signedOut:"failed"}}),connectionAttempts:e.context.importTokenAttempts}),(e,s)=>e.isAuthenticated===s.isAuthenticated&&e.isLoading===s.isLoading&&e.connectionAttempts===s.connectionAttempts))},y=t=>{const e=a.unref(t);return Array.isArray(e)?e.map(s=>y(s)):e&&typeof e=="object"?Object.entries(e).reduce((s,[i,u])=>({...s,[i]:y(u)}),{}):e},D=t=>{const{nhost:e}=E(),s=r.useInterpret(S.createChangeEmailMachine(e.auth.client)),i=r.useSelector(s,m=>m.matches("requesting")),u=r.useSelector(s,m=>m.context.error),h=r.useSelector(s,m=>m.matches("idle.error")),d=r.useSelector(s,m=>m.matches("idle.success"));return{changeEmail:m=>S.changeEmailPromise(s,a.unref(m),y(t)),isLoading:i,error:u,isError:h,needsEmailVerification:d}},R=()=>{const{nhost:t}=E(),e=r.useInterpret(S.createChangePasswordMachine(t.auth.client)),s=r.useSelector(e,l=>l.matches("requesting")),i=r.useSelector(e,l=>l.context.error),u=r.useSelector(e,l=>l.matches("idle.error")),h=r.useSelector(e,l=>l.matches("idle.success"));return{changePassword:l=>S.changePasswordPromise(e,a.unref(l)),isLoading:s,error:i,isError:u,isSuccess:h}},V=()=>{const{nhost:t}=E(),e=r.useInterpret(S.createEnableMfaMachine(t.auth.client)),s=r.useSelector(e,o=>o.matches({idle:"error"})||o.matches({generated:{idle:"error"}})),i=r.useSelector(e,o=>o.matches("generating")),u=r.useSelector(e,o=>o.matches("generated")),h=r.useSelector(e,o=>o.matches({generated:"activating"})),d=r.useSelector(e,o=>o.matches({generated:"activated"})),l=r.useSelector(e,o=>o.context.error),m=r.useSelector(e,o=>o.context.imageUrl||"");return{generateQrCode:()=>S.generateQrCodePromise(e),isGenerating:i,qrCodeDataUrl:m,isGenerated:u,activateMfa:o=>S.activateMfaPromise(e,a.unref(o)),isActivating:h,isActivated:d,isError:s,error:l}},A=()=>{const t=P();return a.computed(()=>t.value?L.jwtDecode(t.value):null)},O=t=>{const{nhost:e}=E(),s=f=>{t.send({type:"ADD",file:f.file,bucketId:f.bucketId||g.value})},i=f=>S.uploadFilePromise({url:e.storage.url,accessToken:e.auth.getAccessToken(),adminSecret:e.adminSecret,...f},t),u=()=>{t.send("CANCEL")},h=()=>{t.send("DESTROY")},d=r.useSelector(t,f=>f.matches("uploading")),l=r.useSelector(t,f=>f.matches("uploaded")),m=r.useSelector(t,f=>f.matches("error")),c=r.useSelector(t,f=>f.context.error||null),n=r.useSelector(t,f=>f.context.progress),o=r.useSelector(t,f=>f.context.id),g=r.useSelector(t,f=>f.context.bucketId),v=r.useSelector(t,f=>{var U;return(U=f.context.file)==null?void 0:U.name});return{add:s,upload:i,cancel:u,destroy:h,isUploaded:l,isUploading:d,isError:m,error:c,progress:n,id:o,bucketId:g,name:v}},F=()=>{const t=r.useInterpret(S.createFileUploadMachine);return O(t)},x=()=>{const t=A();return a.computed(()=>{var e;return((e=t.value)==null?void 0:e["https://hasura.io/jwt/claims"])||null})},q=t=>{const e=x();return a.computed(()=>{var i;const s=a.unref(t);return((i=e.value)==null?void 0:i[s.startsWith("x-hasura-")?s:`x-hasura-${s}`])||null})},j=()=>{const{nhost:t}=E(),e=a.ref([]),s=r.useInterpret(S.createMultipleFilesUploadMachine,{},g=>{g.event.type==="UPLOAD_ERROR"?e.value=g.context.files.filter(v=>{var f;return(f=v.getSnapshot())==null?void 0:f.context.error}):(g.matches("uploaded")||g.event.type==="CLEAR")&&e.value.length>0&&(e.value=[])}),i=g=>{s.send({type:"ADD",...g})},u=g=>S.uploadMultipleFilesPromise({url:t.storage.url,accessToken:t.auth.getAccessToken(),adminSecret:t.adminSecret,...g},s),h=()=>{s.send("CANCEL")},d=()=>{s.send("CLEAR")},l=r.useSelector(s,g=>g.matches("uploading")),m=r.useSelector(s,g=>g.matches("uploaded")),c=r.useSelector(s,g=>g.matches("error")),n=r.useSelector(s,g=>g.context.progress),o=r.useSelector(s,g=>g.context.files);return{upload:u,add:i,clear:d,cancel:h,progress:n,isUploaded:m,isUploading:l,files:o,isError:c,errors:e}},H=t=>{const{nhost:e}=E(),s=P();return a.reactive(new Proxy({},{get(i,u){const h=y(t),d=h!=null&&h.connect?{connect:s.value}:{};return S.encodeQueryParameters(`${e.auth.client.backendUrl}/signin/provider/${u}`,S.rewriteRedirectTo(e.auth.client.clientUrl,{...h,...d}))}}))},$=t=>{const{nhost:e}=E(),s=r.useInterpret(S.createResetPasswordMachine(e.auth.client)),i=r.useSelector(s,m=>m.matches("requesting")),u=r.useSelector(s,m=>m.matches({idle:"success"})),h=r.useSelector(s,m=>m.matches({idle:"error"})),d=r.useSelector(s,m=>m.context.error);return{resetPassword:m=>S.resetPasswordPromise(s,a.unref(m),y(t)),isLoading:i,isError:h,isSent:u,error:d}},Q=t=>{const{nhost:e}=E(),s=r.useInterpret(S.createSendVerificationEmailMachine(e.auth.client)),i=r.useSelector(s,d=>d.matches("requesting")),u=a.reactive({isError:!1,error:null,isSent:!1});return{sendEmail:d=>S.sendVerificationEmailPromise(s,a.unref(d),y(t)),isLoading:i,...a.toRefs(u)}},I=t=>{const e=p();return r.useSelector(e.value,s=>s.context.errors[t]||null,(s,i)=>(s==null?void 0:s.error)===(i==null?void 0:i.error))},J=()=>{const t=p(),e=()=>S.signInAnonymousPromise(t.value),s=I("authentication"),i=r.useSelector(t.value,d=>d.matches({authentication:{authenticating:"anonymous"}})),u=k(),h=r.useSelector(t.value,d=>d.matches({authentication:{signedOut:"failed"}}));return{signInAnonymous:e,isLoading:i,isSuccess:u,isError:h,error:s}},W=()=>{const t=p(),e=(v,f)=>S.signInEmailPasswordPromise(t.value,a.unref(v),a.unref(f)),s=v=>S.signInMfaTotpPromise(t.value,a.unref(v)),i=r.useSelector(t.value,v=>v.context.user,(v,f)=>(v==null?void 0:v.id)===(f==null?void 0:f.id)),u=r.useSelector(t.value,v=>v.context.accessToken.value),h=r.useSelector(t.value,v=>v.context.refreshToken.value),d=I("authentication"),l=k(),m=r.useSelector(t.value,v=>v.matches({authentication:{authenticating:"password"}}),(v,f)=>v===f),c=r.useSelector(t.value,v=>v.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(v,f)=>v===f),n=r.useSelector(t.value,v=>v.context.mfa),o=r.useSelector(t.value,v=>v.matches({authentication:{signedOut:"needsMfa"}}),(v,f)=>v===f),g=r.useSelector(t.value,v=>v.matches({authentication:{signedOut:"failed"}}),(v,f)=>v===f);return{accessToken:u,refreshToken:h,error:d,isError:g,isLoading:m,isSuccess:l,needsEmailVerification:c,needsMfaOtp:o,mfa:n,sendMfaOtp:s,signInEmailPassword:e,user:i}},_=t=>{const e=p(),s=l=>S.signInEmailPasswordlessPromise(e.value,a.unref(l),y(t)),i=I("registration"),u=r.useSelector(e.value,l=>l.matches("registration.passwordlessEmail")),h=r.useSelector(e.value,l=>l.matches("registration.incomplete.needsEmailVerification")),d=r.useSelector(e.value,l=>l.matches("registration.incomplete.failed"));return{signInEmailPasswordless:s,isLoading:u,isSuccess:h,isError:d,error:i}},G=()=>{const t=p(),e=c=>S.signInPATPromise(t.value,a.unref(c)),s=r.useSelector(t.value,c=>c.context.user,(c,n)=>(c==null?void 0:c.id)===(n==null?void 0:n.id)),i=r.useSelector(t.value,c=>c.context.accessToken.value),u=r.useSelector(t.value,c=>c.context.refreshToken.value),h=r.useSelector(t.value,c=>c.context.errors.authentication||null,(c,n)=>(c==null?void 0:c.error)===(n==null?void 0:n.error)),d=r.useSelector(t.value,c=>c.matches({authentication:"signedIn"})),l=r.useSelector(t.value,c=>c.matches({authentication:{authenticating:"password"}}),(c,n)=>c===n),m=r.useSelector(t.value,c=>c.matches({authentication:{signedOut:"failed"}}),(c,n)=>c===n);return{accessToken:i,refreshToken:u,error:h,isError:m,isLoading:l,isSuccess:d,signInPAT:e,user:s}};function Y(t){const e=p(),s=a.ref(""),i=(n,o=t)=>(s.value=a.unref(n),S.signInSmsPasswordlessPromise(e.value,a.unref(n),y(o))),u=async(...n)=>{if(n.length===2){const[g,v]=n;return S.signInSmsPasswordlessOtpPromise(e.value,a.unref(g),a.unref(v))}const[o]=n;return S.signInSmsPasswordlessOtpPromise(e.value,a.unref(s),a.unref(o))},h=r.useSelector(e.value,n=>n.context.errors.registration||null,(n,o)=>(n==null?void 0:n.error)===(o==null?void 0:o.error)),d=r.useSelector(e.value,n=>n.matches("registration.passwordlessSms")||n.matches("registration.passwordlessSmsOtp")),l=r.useSelector(e.value,n=>n.matches("authentication.signedIn")),m=r.useSelector(e.value,n=>n.matches("registration.incomplete.needsOtp")),c=r.useSelector(e.value,n=>n.matches("registration.incomplete.failed"));return{signInSmsPasswordless:i,sendOtp:u,isLoading:d,isSuccess:l,needsOtp:m,isError:c,error:h}}const z=()=>{const t=p(),e=u=>S.signOutPromise(t.value,typeof a.unref(u)=="boolean"?a.unref(u):!1),s=r.useSelector(t.value,u=>u.matches({authentication:{signedOut:"success"}})),i=I("signout");return{signOut:e,isSuccess:s,error:i}},w=()=>{const t=p();return r.useSelector(t.value,e=>e.context.user,(e,s)=>JSON.stringify(e)===JSON.stringify(s))},B=t=>{const e=p(),s=r.useSelector(e.value,o=>o.matches("registration.incomplete.failed")),i=I("registration"),u=r.useSelector(e.value,o=>o.matches("registration.emailPassword")),h=r.useSelector(e.value,o=>o.matches({authentication:"signedIn",registration:"complete"})),d=r.useSelector(e.value,o=>o.matches("registration.incomplete.needsEmailVerification")),l=P(),m=r.useSelector(e.value,o=>o.context.refreshToken.value),c=w();return{signUpEmailPassword:(o,g,v)=>S.signUpEmailPasswordPromise(e.value,a.unref(o),a.unref(g),{...y(t),...y(v)}),isLoading:u,isSuccess:h,isError:s,error:i,needsEmailVerification:d,accessToken:l,refreshToken:m,user:c}},X=()=>{const t=p();return r.useSelector(t.value,e=>{var s;return(s=e.context.user)==null?void 0:s.avatarUrl},(e,s)=>e===s)},Z=()=>{const t=p();return r.useSelector(t.value,e=>{var s;return(s=e.context.user)==null?void 0:s.defaultRole},(e,s)=>e===s)},b=()=>{const t=p();return r.useSelector(t.value,e=>{var s;return(s=e.context.user)==null?void 0:s.displayName},(e,s)=>e===s)},ee=()=>{const t=p();return r.useSelector(t.value,e=>{var s;return(s=e.context.user)==null?void 0:s.email},(e,s)=>e===s)},te=()=>{const t=p();return r.useSelector(t.value,e=>{var s;return(s=e.context.user)==null?void 0:s.id},(e,s)=>e===s)},se=()=>{const t=p();return r.useSelector(t.value,e=>{var s;return(s=e.context.user)==null?void 0:s.isAnonymous},(e,s)=>e===s)},ne=()=>{const t=p();return r.useSelector(t.value,e=>{var s;return(s=e.context.user)==null?void 0:s.locale},(e,s)=>e===s)},re=()=>{const t=p();return r.useSelector(t.value,e=>{var s;return e.matches("authentication.signedIn")?((s=e.context.user)==null?void 0:s.roles)||[]:[]})},oe=()=>{const t=w(),e=x(),{nhost:s}=E(),i=a.computed(()=>{var d,l;return t.value?((d=e.value)==null?void 0:d["x-hasura-auth-elevated"])===((l=t.value)==null?void 0:l.id):!1}),u=a.computed(()=>!!i.value);return{elevateEmailSecurityKey:d=>S.elevateEmailSecurityKeyPromise(s.auth.client,a.unref(d)),elevated:u}},ce=t=>{const e=p(),s=r.useSelector(e.value,o=>!!o.context.errors.registration),i=r.useSelector(e.value,o=>o.context.errors.registration||null,(o,g)=>(o==null?void 0:o.error)===(g==null?void 0:g.error)),u=r.useSelector(e.value,o=>o.matches("registration.securityKey")),h=r.useSelector(e.value,o=>o.matches("registration.incomplete.needsEmailVerification")),d=r.useSelector(e.value,o=>o.matches({authentication:"signedIn",registration:"complete"})),l=(o,g=t)=>S.signUpEmailSecurityKeyPromise(e.value,a.unref(o),a.unref(g)),m=r.useSelector(e.value,o=>o.context.user,(o,g)=>(o==null?void 0:o.id)===(g==null?void 0:g.id)),c=r.useSelector(e.value,o=>o.context.accessToken.value),n=r.useSelector(e.value,o=>o.context.refreshToken.value);return{accessToken:c,refreshToken:n,error:i,isError:s,isLoading:u,isSuccess:d,needsEmailVerification:h,signUpEmailSecurityKey:l,user:m}},ie=()=>{const t=p(),e=n=>S.signInEmailSecurityKeyPromise(t.value,a.unref(n)),s=r.useSelector(t.value,n=>n.context.user,(n,o)=>(n==null?void 0:n.id)===(o==null?void 0:o.id)),i=r.useSelector(t.value,n=>n.context.accessToken.value),u=r.useSelector(t.value,n=>n.context.refreshToken.value),h=r.useSelector(t.value,n=>n.context.errors.authentication||null,(n,o)=>(n==null?void 0:n.error)===(o==null?void 0:o.error)),d=r.useSelector(t.value,n=>n.matches({authentication:"signedIn"})),l=r.useSelector(t.value,n=>n.matches({authentication:{authenticating:"securityKeyEmail"}}),(n,o)=>n===o),m=r.useSelector(t.value,n=>n.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(n,o)=>n===o),c=r.useSelector(t.value,n=>n.matches({authentication:{signedOut:"failed"}}),(n,o)=>n===o);return{accessToken:i,refreshToken:u,error:h,isError:c,isLoading:l,isSuccess:d,needsEmailVerification:m,signInEmailSecurityKey:e,user:s}},ue=()=>{const{nhost:t}=E(),e=a.ref(null),s=a.computed(()=>!e),i=a.computed(()=>!!e),u=a.ref(!1);return{add:async d=>{u.value=!0;const l=await S.addSecurityKeyPromise(t.auth.client,d),{error:m}=l;return e&&(e.value=m),u.value=!1,l},isLoading:u,isSuccess:s,isError:i,error:e}};function ae(t){const e=p(),s=(c,n=t)=>S.signInEmailOTPPromise(e.value,a.unref(c),y(n)),i=async(c,n)=>S.verifyEmailOTPPromise(e.value,a.unref(c),a.unref(n)),u=r.useSelector(e.value,c=>c.context.errors.registration||null,(c,n)=>(c==null?void 0:c.error)===(n==null?void 0:n.error)),h=r.useSelector(e.value,c=>c.matches("registration.signInEmailOTP")||c.matches("registration.verifyEmailOTP")),d=r.useSelector(e.value,c=>c.matches("authentication.signedIn")),l=r.useSelector(e.value,c=>c.matches("registration.incomplete.needsOtp")),m=r.useSelector(e.value,c=>c.matches("registration.incomplete.failed"));return{signInEmailOTP:s,verifyEmailOTP:i,needsOtp:l,isLoading:h,isSuccess:d,isError:m,error:u}}const le=()=>{const t=p(),e=(c,n,o)=>S.signInIdTokenPromise(t.value,{provider:a.unref(c),idToken:a.unref(n),nonce:a.unref(o)}),s=r.useSelector(t.value,c=>c.context.user,(c,n)=>(c==null?void 0:c.id)===(n==null?void 0:n.id)),i=r.useSelector(t.value,c=>c.context.accessToken.value),u=r.useSelector(t.value,c=>c.context.refreshToken.value),h=r.useSelector(t.value,c=>c.context.errors.authentication||null,(c,n)=>(c==null?void 0:c.error)===(n==null?void 0:n.error)),d=r.useSelector(t.value,c=>c.matches({authentication:"signedIn"})),l=r.useSelector(t.value,c=>c.matches({authentication:{authenticating:"idToken"}}),(c,n)=>c===n),m=r.useSelector(t.value,c=>c.matches({authentication:{signedOut:"failed"}}),(c,n)=>c===n);return{accessToken:i,refreshToken:u,error:h,isError:m,isLoading:l,isSuccess:d,signInIdToken:e,user:s}},de=()=>{const{nhost:t}=E(),e=a.ref(null),s=a.computed(()=>!e),i=a.computed(()=>!!e),u=a.ref(!1);return{linkIdToken:async({provider:d,idToken:l,nonce:m})=>{u.value=!0;const c=await S.linkIdTokenPromise(t.auth.client,{provider:d,idToken:l,...m&&{nonce:m}}),{error:n}=c;return e&&(e.value=n),u.value=!1,c},isLoading:u,isSuccess:s,isError:i,error:e}},me=()=>{const t=p(),e=()=>S.signInSecurityKeyPromise(t.value),s=r.useSelector(t.value,n=>n.context.user,(n,o)=>(n==null?void 0:n.id)===(o==null?void 0:o.id)),i=r.useSelector(t.value,n=>n.context.accessToken.value),u=r.useSelector(t.value,n=>n.context.refreshToken.value),h=r.useSelector(t.value,n=>n.context.errors.authentication||null,(n,o)=>(n==null?void 0:n.error)===(o==null?void 0:o.error)),d=r.useSelector(t.value,n=>n.matches({authentication:"signedIn"})),l=r.useSelector(t.value,n=>n.matches({authentication:{authenticating:"securityKeyEmail"}}),(n,o)=>n===o),m=r.useSelector(t.value,n=>n.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(n,o)=>n===o),c=r.useSelector(t.value,n=>n.matches({authentication:{signedOut:"failed"}}),(n,o)=>n===o);return{accessToken:i,refreshToken:u,error:h,isError:c,isLoading:l,isSuccess:d,needsEmailVerification:m,signInSecurityKey:e,user:s}};exports.DefaultNhostClient=T;exports.NhostClient=N;exports.useAccessToken=P;exports.useAddSecurityKey=ue;exports.useAuthInterpreter=p;exports.useAuthenticated=k;exports.useAuthenticationStatus=M;exports.useChangeEmail=D;exports.useChangePassword=R;exports.useConfigMfa=V;exports.useDecodedAccessToken=A;exports.useElevateSecurityKeyEmail=oe;exports.useFileUpload=F;exports.useFileUploadItem=O;exports.useHasuraClaim=q;exports.useHasuraClaims=x;exports.useLinkIdToken=de;exports.useMultipleFilesUpload=j;exports.useNhostClient=E;exports.useProviderLink=H;exports.useResetPassword=$;exports.useSendVerificationEmail=Q;exports.useSignInAnonymous=J;exports.useSignInEmailOTP=ae;exports.useSignInEmailPassword=W;exports.useSignInEmailPasswordless=_;exports.useSignInEmailSecurityKey=ie;exports.useSignInIdToken=le;exports.useSignInPAT=G;exports.useSignInSecurityKey=me;exports.useSignInSmsPasswordless=Y;exports.useSignOut=z;exports.useSignUpEmailPassword=B;exports.useSignUpEmailSecurityKey=ce;exports.useUserAvatarUrl=X;exports.useUserData=w;exports.useUserDefaultRole=Z;exports.useUserDisplayName=b;exports.useUserEmail=ee;exports.useUserId=te;exports.useUserIsAnonymous=se;exports.useUserLocale=ne;exports.useUserRoles=re;
//# sourceMappingURL=index.cjs.js.map
